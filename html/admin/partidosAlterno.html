<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Partidos | Deportes FAP</title>
    <link rel="stylesheet" href="/css/partidos.css" crossorigin="anonymous">
    <style>
    .pagination {
        display: flex;
        justify-content: center;
        padding: 1rem 0;
        list-style: none;
        border-radius: 0.5rem;
        gap: 0.3rem;
    }

    .pagination .page-item {
        display: inline-block;
    }

    .pagination .page-link {
        color: #007bff;
        background-color: #fff;
        border: 1px solid #dee2e6;
        padding: 0.5rem 0.75rem;
        text-decoration: none;
        border-radius: 0.375rem;
        transition: background-color 0.2s ease, color 0.2s ease;
    }

    .pagination .page-link:hover {
        background-color: #007bff;
        color: #fff;
    }

    .pagination .active .page-link {
        z-index: 1;
        color: #fff;
        background-color: #007bff;
        border-color: #007bff;
    }

    .pagination .page-item.disabled .page-link {
        color: #6c757d;
        pointer-events: none;
        background-color: #fff;
        border-color: #dee2e6;
    }
</style>
</head>

<body>

    <div class="navbar">
        <img src="/img/logo.png" alt="Logo" />
        <a href="#">Deportes FAP</a>
        <a href="#">Usuarios</a>
        <a href="#">Partidos</a>
        <a href="#">Jugadores</a>
        <a href="#">Comunicados</a>
        <a href="#">Reglamos</a>
        <a href="#">Correo</a>
        <a href="#">Equipos</a>
        <a href="#">Resultados</a>
        <a href="#">Goleadores</a>
    </div>

    <div class="container">
        <!-- BOTÓN AGREGAR -->
        <div class="top-bar">
            <input type="text" id="buscador" placeholder="Buscar en la tabla..." />
            <button onclick="abrirModal()">Agregar +</button>
        </div>

        <!-- TABLA DE PARTIDOS -->
        <div>
            <table id="tablaPartidos">
                <thead>
                    <tr>
                        <th>Código</th>
                        <th>Equipo 1</th>
                        <th>Equipo 2</th>
                        <th>Delegado 1</th>
                        <th>Delegado 2</th>
                        <th>Fecha</th>
                        <th>Hora</th>
                        <th></th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Sit.</td>
                        <td>Cameroun</td>
                        <td>Douala</td>
                        <td>a</td>
                        <td>b</td>
                        <td class="fecha">2025-06-20</td>
                        <td class="hora">15:30</td>
                        <td><span class="edit-icon" onclick="abrirEditor(this)">✏️</span></td>
                    </tr>
                    <tr>
                        <td>Sit.</td>
                        <td>Cameroun</td>
                        <td>Douala</td>
                        <td>a</td>
                        <td>b</td>
                        <td class="fecha">2025-06-20</td>
                        <td class="hora">15:30</td>
                        <td><span class="edit-icon" onclick="abrirEditor(this)">✏️</span></td>
                    </tr>
                    <tr>
                        <td>Sit.</td>
                        <td>Cameroun</td>
                        <td>Douala</td>
                        <td>a</td>
                        <td>b</td>
                        <td class="fecha">2025-06-20</td>
                        <td class="hora">15:30</td>
                        <td><span class="edit-icon" onclick="abrirEditor(this)">✏️</span></td>
                    </tr>
                    <tr>
                        <td>Sit.</td>
                        <td>Cameroun</td>
                        <td>Douala</td>
                        <td>a</td>
                        <td>b</td>
                        <td class="fecha">2025-06-20</td>
                        <td class="hora">15:30</td>
                        <td><span class="edit-icon" onclick="abrirEditor(this)">✏️</span></td>
                    </tr>
                    <tr>
                        <td>Sit.</td>
                        <td>Cameroun</td>
                        <td>Douala</td>
                        <td>a</td>
                        <td>b</td>
                        <td class="fecha">2025-06-20</td>
                        <td class="hora">15:30</td>
                        <td><span class="edit-icon" onclick="abrirEditor(this)">✏️</span></td>
                    </tr>
                    <tr>
                        <td>Sit.</td>
                        <td>Cameroun</td>
                        <td>Douala</td>
                        <td>a</td>
                        <td>b</td>
                        <td class="fecha">2025-06-20</td>
                        <td class="hora">15:30</td>
                        <td><span class="edit-icon" onclick="abrirEditor(this)">✏️</span></td>
                    </tr>
                    <tr>
                        <td>Sit.</td>
                        <td>Cameroun</td>
                        <td>Douala</td>
                        <td>a</td>
                        <td>b</td>
                        <td class="fecha">2025-06-20</td>
                        <td class="hora">15:30</td>
                        <td><span class="edit-icon" onclick="abrirEditor(this)">✏️</span></td>
                    </tr>
                    <tr>
                        <td>Sit.</td>
                        <td>Cameroun</td>
                        <td>Douala</td>
                        <td>a</td>
                        <td>b</td>
                        <td class="fecha">2025-06-20</td>
                        <td class="hora">15:30</td>
                        <td><span class="edit-icon" onclick="abrirEditor(this)">✏️</span></td>
                    </tr>
                    <tr>
                        <td>Sit.</td>
                        <td>Cameroun</td>
                        <td>Douala</td>
                        <td>a</td>
                        <td>b</td>
                        <td class="fecha">2025-06-20</td>
                        <td class="hora">15:30</td>
                        <td><span class="edit-icon" onclick="abrirEditor(this)">✏️</span></td>
                    </tr>
                </tbody>
            </table>
        </div>
        <!-- Paginación -->
        <nav>
            <ul class="pagination justify-content-center" id="pagination">
                <!-- JS rellenará esto -->
            </ul>
        </nav>
    </div>




    <!-- MODAL para crear partidos-->
    <div id="modalAgregar" class="modal">
        <div class="modal-content">
            <h2>Registrar Nuevos Partidos</h2>
            <span class="cerrar-modal" onclick="cerrarAgregar()">×</span>
            <!-- SELECT EQUIPOS -->
            <div class="form-row">
                <label>Equipos disponibles</label>
                <select id="equiposDisponibles" multiple>
                    <option value="Cameroun">Cameroun</option>
                    <option value="Douala">Douala</option>
                    <option value="Yaounde">Yaounde</option>
                    <option value="Garoua">Garoua</option>
                    <option value="Kribi">Kribi</option>
                    <option value="Buea">Buea</option>
                    <option value="Ebolowa">Ebolowa</option>
                    <option value="Bertoua">Bertoua</option>
                    <option value="Bafoussam">Bafoussam</option>
                    <option value="Bamenda">Bamenda</option>
                    <option value="Limbe">Limbe</option>
                    <option value="Ngaoundere">Ngaoundere</option>
                </select>
            </div>

            <!-- DONDE APARECEN LOS PARES -->
            <div id="parejasContainer" class="parejas"></div>

            <!-- BOTONES -->
            <div class="form-actions">
                <button onclick="sortearEquipos()">Sortear</button>
                <button onclick="crearPartidos()">Crear</button>
                <button class="btn-anular" onclick="cerrarAgregar()">Anular</button>
                <!--<button onclick="location.reload()">Anular</button>-->

            </div>
        </div>
    </div>

    <!-- MODAL para editar fecha y hora-->
    <div id="modalEditar" class="modal">
        <div class="modal-content">
            <h3>Editar Fecha y Hora</h3>
            <label for="nuevaFecha">Fecha:</label>
            <input type="date" id="nuevaFecha" />
            <label for="nuevaHora">Hora:</label>
            <input type="time" id="nuevaHora" />
            <div class="modal-actions">
                <button class="btn-aplicar" onclick="aplicarCambios()">Aplicar</button>
                <button class="btn-anular" onclick="cerrarEditor()">Anular</button>
            </div>
        </div>
    </div>

    <script>
        function abrirModal() {
            document.getElementById("modalAgregar").style.display = "block";
        }

        function cerrarModal() {
            document.getElementById("modalAgregar").style.display = "none";
        }

        // Cerrar si haces clic fuera del contenido
        window.onclick = function (event) {
            const modal = document.getElementById("modalAgregar");
            if (event.target == modal) {
                cerrarModal();
            }
        }
    </script>

    <script>
        function sortearEquipos() {
            const select = document.getElementById("equiposDisponibles");
            const seleccionados = Array.from(select.selectedOptions).map(opt => opt.value);

            if (seleccionados.length % 2 !== 0) {
                alert("Por favor selecciona un número par de equipos.");
                return;
            }

            // Barajar los equipos aleatoriamente
            const mezclados = seleccionados
                .map(valor => ({ valor, sort: Math.random() }))
                .sort((a, b) => a.sort - b.sort)
                .map(obj => obj.valor);

            const container = document.getElementById("parejasContainer");
            container.innerHTML = "";

            for (let i = 0; i < mezclados.length; i += 2) {
                const equipo1 = mezclados[i];
                const equipo2 = mezclados[i + 1];

                const row = document.createElement("div");
                row.className = "form-row";
                row.innerHTML = `
        <label>Partido ${i / 2 + 1}</label>
        <input type="text" value="${equipo1}" readonly />
        <strong>vs</strong>
        <input type="text" value="${equipo2}" readonly />
      `;
                container.appendChild(row);
            }
        }
    </script>

    <script>
        let parejas = [];
        let contadorPartido = 1; // contador global para numeración

        function sortearEquipos() {
            const select = document.getElementById("equiposDisponibles");
            const seleccionados = Array.from(select.selectedOptions).map(opt => opt.value);

            if (seleccionados.length % 2 !== 0) {
                alert("Selecciona un número PAR de equipos.");
                return;
            }

            // Barajar
            const mezclados = seleccionados
                .map(val => ({ val, rand: Math.random() }))
                .sort((a, b) => a.rand - b.rand)
                .map(obj => obj.val);

            // Limpiar y construir nuevas parejas
            const container = document.getElementById("parejasContainer");
            container.innerHTML = '';
            parejas = [];

            for (let i = 0; i < mezclados.length; i += 2) {
                const eq1 = mezclados[i];
                const eq2 = mezclados[i + 1];
                parejas.push({ equipo1: eq1, equipo2: eq2 });

                const row = document.createElement("div");
                row.className = "form-row";
                row.innerHTML = `
        <label>Partido ${i / 2 + 1}:</label>
        <input type="text" value="${eq1}" readonly />
        <strong>vs</strong>
        <input type="text" value="${eq2}" readonly />
      `;
                container.appendChild(row);
            }
        }

        function crearPartidos() {
            const tbody = document.getElementById("tablaPartidos").querySelector("tbody");

            if (parejas.length === 0) {
                alert("Primero debes sortear los equipos.");
                return;
            }

            parejas.forEach(par => {
                const fila = document.createElement("tr");
                fila.innerHTML = `
        <td>${contadorPartido++}</td>
        <td>${par.equipo1}</td>
        <td>${par.equipo2}</td>
        <td>a</td>
        <td>b</td>
        <td>---</td>
        <td>--:--</td>
        <td><span class="edit-icon" onclick="abrirEditor(this)">✏️</span></td>
      `;
                tbody.appendChild(fila);
            });

            alert("🎉 Partidos añadidos a la tabla correctamente.");
            parejas = []; // Limpiar el array de partidos creados
            document.getElementById("parejasContainer").innerHTML = '';
        }
        function cerrarAgregar() {
            document.getElementById("modalAgregar").style.display = "none";
            filaEditando = null;
        }
        // Cierre al hacer clic fuera del modal
        window.onclick = function (event) {
            const modal = document.getElementById("modalAgregar");
            if (event.target == modal) cerrarAgregar();
        };
    </script>
    <script>
        let filaEditando = null;

        function abrirEditor(icono) {
            filaEditando = icono.closest("tr");
            const fecha = filaEditando.querySelector(".fecha").textContent;
            const hora = filaEditando.querySelector(".hora").textContent;

            document.getElementById("nuevaFecha").value = fecha;
            document.getElementById("nuevaHora").value = hora;

            document.getElementById("modalEditar").style.display = "block";
        }

        function cerrarEditor() {
            document.getElementById("modalEditar").style.display = "none";
            filaEditando = null;
        }

        function aplicarCambios() {
            if (!filaEditando) return;

            const nuevaFecha = document.getElementById("nuevaFecha").value;
            const nuevaHora = document.getElementById("nuevaHora").value;

            filaEditando.querySelector(".fecha").textContent = nuevaFecha;
            filaEditando.querySelector(".hora").textContent = nuevaHora;

            cerrarEditor();
        }

        // Cierre al hacer clic fuera del modal
        window.onclick = function (event) {
            const modal = document.getElementById("modalEditar");
            if (event.target == modal) cerrarEditor();
        };
    </script>

    <!-- Bootstrap + Script buscador + paginación -->
    <script>
        const rowsPerPage = 5;
        const tabla = document.getElementById('tablaPartidos');
        const tbody = tabla.querySelector('tbody');
        const searchInput = document.getElementById('buscador');
        const pagination = document.getElementById('pagination');
        let currentPage = 1;

        function renderTableRows() {
            const rows = Array.from(tbody.querySelectorAll('tr'));
            const searchTerm = searchInput.value.toLowerCase();
            const filtered = rows.filter(row =>
                row.textContent.toLowerCase().includes(searchTerm)
            );

            const totalPages = Math.ceil(filtered.length / rowsPerPage);
            const start = (currentPage - 1) * rowsPerPage;
            const end = start + rowsPerPage;

            // Ocultar todas las filas
            rows.forEach(row => row.style.display = 'none');
            // Mostrar las que coinciden con la búsqueda y la página actual
            filtered.slice(start, end).forEach(row => row.style.display = '');

            renderPagination(totalPages);
        }

        function renderPagination(totalPages) {
            pagination.innerHTML = '';

            const createPageItem = (text, page) => {
                const li = document.createElement('li');
                li.className = `page-item ${page === currentPage ? 'active' : ''}`;
                const a = document.createElement('a');
                a.className = 'page-link';
                a.href = '#';
                a.textContent = text;
                a.onclick = e => {
                    e.preventDefault();
                    currentPage = page;
                    renderTableRows();
                };
                li.appendChild(a);
                return li;
            };

            if (currentPage > 1)
                pagination.appendChild(createPageItem('‹', currentPage - 1));

            for (let i = 1; i <= totalPages; i++)
                pagination.appendChild(createPageItem(i, i));

            if (currentPage < totalPages)
                pagination.appendChild(createPageItem('›', currentPage + 1));
        }

        // Buscar y paginar al escribir
        searchInput.addEventListener('input', () => {
            currentPage = 1;
            renderTableRows();
        });

        // Inicializar al cargar
        window.addEventListener('load', renderTableRows);
    </script>
</body>

</html>